---
applyTo: python
description: Testing requirements and methodologies
---

# Testing Requirements
- Write parameterized tests for both happy and sad paths
- Ensure all existing tests still pass
- Verify code coverage remains above 95%
- Use pytest fixtures for reusable test components
- Mock external dependencies (network calls, file I/O)
- Test edge cases and error conditions
- **Systematically identify and test missing branches**: Use coverage analysis to find uncovered conditional paths and exception handlers
- **Test exception handling thoroughly**: Ensure all try/catch blocks have corresponding test cases for both expected and unexpected exceptions
- **Validate boundary conditions**: Test edge cases like empty inputs, maximum values, and boundary conditions (e.g., string lengths, numeric limits)
- **Test CLI argument combinations**: Verify all format options, threading configurations, and parameter interactions

# Validation and Quality Assurance

## After Substantive Changes
- **Always run tests**: Execute the full test suite after any code modifications
- **Check coverage**: Ensure coverage remains above 95% using `pytest --cov --cov-fail-under=95`
- **Validate functionality**: Test both happy path and edge cases manually if needed
- **Review error handling**: Verify that exceptions are properly caught and logged
- **Check CLI interfaces**: Test command-line arguments and help text

## Coverage Analysis Approach
- Use `pytest --cov-report=term-missing` to identify uncovered lines
- Focus on conditional branches (`if/elif/else`) that may not be exercised
- Target exception handlers and error paths
- Prioritize functions with complex logic or multiple code paths
- Create targeted test cases for specific missing branches rather than broad tests

## Testing Patterns by Functionality Type

### Exception Handling Tests
- Test both expected and unexpected exceptions
- Verify proper logging occurs in exception paths
- Ensure resources are cleaned up appropriately
- Test retry logic and failure thresholds

### CLI Argument Tests
- Test all valid argument combinations
- Verify default values are applied correctly
- Test argument validation and error messages
- Check that mutually exclusive options work properly

### Data Processing Tests
- Test boundary conditions (empty inputs, maximum sizes)
- Verify data transformation logic
- Test format detection and parsing
- Ensure deduplication works at all levels

### Concurrent/Multi-threaded Tests
- Test both single-threaded and multi-threaded execution
- Verify exception handling in threaded contexts
- Ensure thread safety and proper synchronization
- Test thread pool management and cleanup
